---
phase: 03-leaderboard-social
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/schema.sql
  - src/lib/leaderboard.ts
  - src/components/Leaderboard.tsx
  - src/App.tsx
autonomous: true
requirements: [LEAD-01, LEAD-02]

must_haves:
  truths:
    - "Leaderboard shows all fighters ranked by win count"
    - "Win count is visible for each fighter"
    - "Leaderboard updates automatically after fights"
  artifacts:
    - path: "src/components/Leaderboard.tsx"
      provides: "Ranked list of fighters by wins"
      min_lines: 50
    - path: "src/lib/leaderboard.ts"
      provides: "Leaderboard API with win counts"
      exports: ["getLeaderboard", "getWinCount"]
  key_links:
    - from: "src/components/Leaderboard.tsx"
      to: "src/lib/leaderboard.ts"
      via: "import getLeaderboard"
      pattern: "getLeaderboard\\(\\)"
    - from: "src/lib/leaderboard.ts"
      to: "supabase/fights"
      via: "query fights table for winner_id counts"
      pattern: "count.*winner_id"
---

<objective>
Create leaderboard system showing fighters ranked by wins
</objective>

<execution_context>
@/Users/fightbook/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/02-combat-system/02-01-SUMMARY.md
@.planning/phases/02-combat-system/02-02-SUMMARY.md
@supabase/schema.sql
@src/lib/fightStorage.ts
</context>

<tasks>

<task type="auto">
  <name>Add win_count column to fighters table</name>
  <files>supabase/schema.sql</files>
  <action>
Add `win_count` column (integer default 0) to the fighters table in schema.sql. This tracks total wins per fighter. Add index on win_count for sorting.

Also add view or function to compute win counts from fights table:
- Count wins per fighter by querying winner_id in fights table
- Or create a materialized view for performance
  </action>
  <verify>
Check schema.sql has win_count column and win_count index
  </verify>
  <done>Fighters table has win_count column for tracking wins</done>
</task>

<task type="auto">
  <name>Create leaderboard API</name>
  <files>src/lib/leaderboard.ts</files>
  <action>
Create src/lib/leaderboard.ts with:
- `getLeaderboard()` - Returns fighters sorted by win_count DESC, includes name and win_count
- `getWinCount(fighterId)` - Returns win count for specific fighter  
- `incrementWinCount(fighterId)` - Called after fight to update wins
- Should work with Supabase when configured, fallback to localStorage tracking

The API should join with fighters table to get fighter names, return array of {id, name, winCount}
  </action>
  <verify>
File created with all exported functions. TypeScript compiles without errors.
  </verify>
  <done>Leaderboard API provides sorted list of fighters by wins</done>
</task>

<task type="auto">
  <name>Build Leaderboard UI component</name>
  <files>src/components/Leaderboard.tsx</files>
  <action>
Create Leaderboard.tsx component:
- Shows table/card list of fighters ranked by wins (1st, 2nd, 3rd highlighted)
- Each row shows: rank, fighter name, win count
- Trophy icon for top 3
- Empty state if no fighters
- "Your Rank" indicator if user owns the fighter
- Use existing UI components (Card, Table, Badge from shadcn)
- Fetch leaderboard on mount, refresh after fights
  </action>
  <verify>
Component renders without errors. Shows ranked list.
  </verify>
  <done>Leaderboard displays fighters ranked by win count</done>
</task>

</tasks>

<verification>
- [x] win_count column exists in fighters table
- [x] getLeaderboard returns fighters sorted by wins
- [x] Leaderboard.tsx displays ranked fighters
- [x] Win count visible for each fighter
</verification>

<success_criteria>
Leaderboard shows fighters ranked by wins with visible win count for each fighter
</success_criteria>

<output>
After completion, create `.planning/phases/03-leaderboard-social/03-01-SUMMARY.md`
</output>
