---
phase: 03-leaderboard-social
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - src/components/FightHistory.tsx
  - src/components/FightCard.tsx
  - supabase/schema.sql
  - src/lib/voting.ts
  - src/components/VoteButton.tsx
  - src/components/PrizeAward.tsx
autonomous: true
requirements: [SOCL-01, SOCL-02, SOCL-03]

must_haves:
  truths:
    - "User can share fight recap to X (Twitter) with one click"
    - "Users can vote on most entertaining fight"
    - "Entertaining fights can earn bonus $FIGHT prize"
  artifacts:
    - path: "src/components/FightHistory.tsx"
      provides: "Share to X button on each fight"
      min_lines: 10
    - path: "src/lib/voting.ts"
      provides: "Vote API for entertaining fights"
      exports: ["voteForFight", "getVoteCount", "hasVoted"]
    - path: "src/components/VoteButton.tsx"
      provides: "Vote UI component"
    - path: "src/components/PrizeAward.tsx"
      provides: "Bonus prize option for entertaining fights"
  key_links:
    - from: "src/components/FightHistory.tsx"
      to: "X (Twitter)"
      via: "window.open with tweet URL"
      pattern: "twitter\\.com.*intent.*tweet"
    - from: "src/components/VoteButton.tsx"
      to: "src/lib/voting.ts"
      via: "import voteForFight"
      pattern: "voteForFight\\("
    - from: "src/components/PrizeAward.tsx"
      to: "fights table"
      via: "awardPrize with bonus flag"
      pattern: "entertaining.*bonus"
---

<objective>
Add social features: share to X, voting on entertaining fights, bonus prizes
</objective>

<execution_context>
@/Users/fightbook/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/03-leaderboard-social/03-01-PLAN.md
@src/components/FightHistory.tsx
@src/components/PrizeAward.tsx
@src/lib/fightStorage.ts
</context>

<tasks>

<task type="auto">
  <name>Add share to X (Twitter) button</name>
  <files>src/components/FightHistory.tsx</files>
  <action>
Add "Share" button to each fight card in FightHistory.tsx:

1. Create share function that generates tweet text:
   - "Just watched {fighter1} vs {fighter2}! {winner} wins by {method} in Round {round}! #AIFights #FightBook"
   
2. Add share button next to each fight card (icon: share/twitter)
3. On click, opens X intent URL: `https://twitter.com/intent/tweet?text={encodedText}`
4. Use window.open with '_blank' target

This is purely client-side JavaScript - no backend needed.
  </action>
  <verify>
Share button appears on fight cards. Clicking opens X tweet composer.
  </verify>
  <done>User can share any fight recap to X with one click</done>
</task>

<task type="auto">
  <name>Create voting system database schema</name>
  <files>supabase/schema.sql</files>
  <action>
Add to schema.sql:

1. Create `fight_votes` table:
   - id (UUID, PK)
   - fight_id (UUID, references fights(id))
   - user_id (UUID, references auth.users) 
   - created_at (timestamptz)
   
2. Add `is_entertaining` column to fights table (boolean, default false)
   - This flags fights that earned bonus for being entertaining
   
3. RLS: One vote per user per fight (upsert or check on insert)
  </verify>
  <done>Database schema supports voting on fights</done>
</task>

<task type="auto">
  <name>Create voting API</name>
  <files>src/lib/voting.ts</files>
  <action>
Create src/lib/voting.ts with:
- `voteForFight(fightId, userId)` - Add vote for entertaining fight
- `getVoteCount(fightId)` - Get total votes for a fight
- `hasVoted(fightId, userId)` - Check if user already voted
- `getMostEntertainingFights(limit)` - Get fights with most votes
- Fallback to localStorage when Supabase not configured

Should handle the case where user already voted (either prevent or allow toggle)
  </action>
  <verify>
File created with all exported functions. TypeScript compiles.
  </verify>
  <done>Voting API allows users to vote for entertaining fights</done>
</task>

<task type="auto">
  <name>Create VoteButton component</name>
  <files>src/components/VoteButton.tsx</files>
  <action>
Create VoteButton.tsx component:
- Shows "Entertaining" vote button on fight cards
- Displays vote count next to button
- Filled/highlighted state if user already voted
- Calls voting API on click
- Use emoji or icon (fire/star/thumbs up)
- Shows toast on successful vote

Add VoteButton to FightHistory.tsx fight cards
  </action>
  <verify>
VoteButton renders on fight cards. Clicking toggles vote state.
  </verify>
  <done>Users can vote on most entertaining fight</done>
</task>

<task type="auto">
  <name>Extend prize system for bonus</name>
  <files>src/components/PrizeAward.tsx</files>
  <action>
Update PrizeAward.tsx:

1. Add checkbox/toggle: "Bonus for entertaining fight"
2. When checked, adds bonus amount on top of regular prize
3. Store in fights table: is_entertaining = true when bonus awarded
4. Update awardPrize function to accept bonus flag

The bonus is separate from regular prize - fighters can earn both for winning AND being entertaining.
  </action>
  <verify>
PrizeAward shows bonus checkbox. Awarding prize with bonus marks fight as entertaining.
  </verify>
  <done>Entertaining fights can earn bonus $FIGHT prize</done>
</task>

</tasks>

<verification>
- [x] Share button opens X tweet composer with fight details
- [x] Users can vote on fight cards
- [x] Vote count displays on fight cards
- [x] PrizeAward has bonus option for entertaining fights
- [x] Fighting being marked as entertaining persists to database
</verification>

<success_criteria>
Users can share fights to X, vote on entertaining fights, and award bonus prizes
</success_criteria>

<output>
After completion, create `.planning/phases/03-leaderboard-social/03-02-SUMMARY.md`
</output>
